<div class="img">
<picture class="c-image">
        <source srcset="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" media="(min-width:1084px)">
        <source srcset="http://compass.xbox.com/assets/6d/33/6d335d8d-e7df-4ad1-beed-4a9e5f6d130b.jpg?n=SWBF-MWF_Highlight-Feature-768_New-Hero_1083x609.jpg" media="(min-width:768px)">
        <source srcset="http://compass.xbox.com/assets/28/c1/28c1a5a6-4839-4c73-bbca-4a9ee786919c.jpg?n=SWBF-MWF_Highlight-Feature-0_New-Hero_767x400.jpg" media="(min-width:0)">
        <img srcset="" src="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" alt="Placeholder with grey background and dimension watermark without any imagery">
    </picture>
</div>

<div class="img">
<picture class="c-image">
        <source srcset="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" media="(min-width:1084px)">
        <source srcset="http://compass.xbox.com/assets/6d/33/6d335d8d-e7df-4ad1-beed-4a9e5f6d130b.jpg?n=SWBF-MWF_Highlight-Feature-768_New-Hero_1083x609.jpg" media="(min-width:768px)">
        <source srcset="http://compass.xbox.com/assets/28/c1/28c1a5a6-4839-4c73-bbca-4a9ee786919c.jpg?n=SWBF-MWF_Highlight-Feature-0_New-Hero_767x400.jpg" media="(min-width:0)">
        <img srcset="" src="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" alt="Placeholder with grey background and dimension watermark without any imagery">
    </picture>
</div>


<div class="img">
<picture class="c-image">
        <source srcset="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" media="(min-width:1084px)">
        <source srcset="http://compass.xbox.com/assets/6d/33/6d335d8d-e7df-4ad1-beed-4a9e5f6d130b.jpg?n=SWBF-MWF_Highlight-Feature-768_New-Hero_1083x609.jpg" media="(min-width:768px)">
        <source srcset="http://compass.xbox.com/assets/28/c1/28c1a5a6-4839-4c73-bbca-4a9ee786919c.jpg?n=SWBF-MWF_Highlight-Feature-0_New-Hero_767x400.jpg" media="(min-width:0)">
        <img srcset="" src="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" alt="Placeholder with grey background and dimension watermark without any imagery">
    </picture>
</div>

<div class="img">
<picture class="c-image">
        <source srcset="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" media="(min-width:1084px)">
        <source srcset="http://compass.xbox.com/assets/6d/33/6d335d8d-e7df-4ad1-beed-4a9e5f6d130b.jpg?n=SWBF-MWF_Highlight-Feature-768_New-Hero_1083x609.jpg" media="(min-width:768px)">
        <source srcset="http://compass.xbox.com/assets/28/c1/28c1a5a6-4839-4c73-bbca-4a9ee786919c.jpg?n=SWBF-MWF_Highlight-Feature-0_New-Hero_767x400.jpg" media="(min-width:0)">
        <img srcset="" src="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" alt="Placeholder with grey background and dimension watermark without any imagery">
    </picture>
</div>

<div class="img">
<picture class="c-image">
        <source srcset="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" media="(min-width:1084px)">
        <source srcset="http://compass.xbox.com/assets/6d/33/6d335d8d-e7df-4ad1-beed-4a9e5f6d130b.jpg?n=SWBF-MWF_Highlight-Feature-768_New-Hero_1083x609.jpg" media="(min-width:768px)">
        <source srcset="http://compass.xbox.com/assets/28/c1/28c1a5a6-4839-4c73-bbca-4a9ee786919c.jpg?n=SWBF-MWF_Highlight-Feature-0_New-Hero_767x400.jpg" media="(min-width:0)">
        <img srcset="" src="http://compass.xbox.com/assets/5e/64/5e645f4c-7dbf-406d-8ac1-f4fdffb88c3b.jpg?n=SWBF-MWF_Highlight-Feature-1084_New-Hero_1600x600.jpg" alt="Placeholder with grey background and dimension watermark without any imagery">
    </picture>
</div>



<style>


</style>





<script>




  var lazyTest = setInterval(function() {
    if (typeof(allGames) === "object") {
      if (Object.keys(allGames).length > 0) {
        clearInterval(lazyTest);
        setTimeout(function() {
          lazyLoad();
          console.log("running lazyload")
        }, 800);
      }
    } else {
      clearInterval(lazyTest);
      lazyLoad();
    }
  }, 300)

  function lazyLoad() {

    // global variables
    var images                      = document.getElementsByTagName("img"),
        sourceTag                   = document.getElementsByTagName("source"),
        galleryImages             = document.querySelector(".m-product-placement-item"),
        whatsNew                   = document.querySelectorAll("#whatsnew picture img"),
        whatsNewSection       = document.querySelector("#whatsnew"),
        galleryImgs                 = document.querySelectorAll(".media-gallery-black img"),
        gallerySource              = document.querySelectorAll('.context-video source'),
        purchaseSectionImgs  = document.querySelectorAll(".purchaseSection img");

    

    //iterate through all the images
    for(var i = 0; i < images.length; i++) {
     var imageSrc = images[i].getAttribute("src");
     images[i].removeAttribute("src");
     images[i].setAttribute("data-src", imageSrc);

    }

    //iterate through all of the source tags
    for(var i = 0; i < sourceTag.length; i++) {
     var sourceTagSrc = sourceTag[i].getAttribute("srcset");
     sourceTag[i].removeAttribute('srcset');
     sourceTag[i].removeAttribute('src');
     sourceTag[i].setAttribute('data-src', sourceTagSrc);

    }


//chrome fix for the whats new section
//loads whatnew section at 2000 scroll height
/*
window.addEventListener('scroll', scrollHeight);
function scrollHeight() {
//console.log(window.pageYOffset);
if(window.pageYOffset > 2000) {
   for(var i = 0; i < whatsNew.length; i++) {
     //whatsNew[i].style.border = "3px solid red";
     const whatsNewDataSrc = whatsNew[i].getAttribute('data-src');
     whatsNew[i].setAttribute('src', whatsNewDataSrc);
   }
 }
};*/




    // Observer Lazy load section

    const dataImages = document.querySelectorAll("[data-src]");

    function preloadImage(img) {
       const src = img.getAttribute("data-src");
      

       if(!src) {
         return;
       }
       img.src= src;
       img.srcset = src;

    }

    const imgOptions = {
      threshold: 1,
      rootMargin: "-100px 0px -100px 0px"
    };

    const imgObserver = new IntersectionObserver((entries, imgObserver) => {
      entries.forEach(entry => {
        if(!entry.isIntersecting) {
          return;
        } else {
          preloadImage(entry.target);
          imgObserver.unobserve(entry.target);
        }
       })
    }, imgOptions)


    dataImages.forEach(image => {
      imgObserver.observe(image);

    })

  }



</script>